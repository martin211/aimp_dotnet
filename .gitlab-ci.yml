variables:
  VERSION: "$AIMP_VERSION.$CI_JOB_ID"

stages:
  - analysis_start
  - build
  - analysis_end
  - zip_publish
  - documentation
  - publish_documentation

docker_start:
  stage: analysis_start
  script:
  - Import-Module CiBuildTools
  - Start-DockerContainer -containerName dev.sonarqube

analysis_start:
  stage: analysis_start
  script:
  - Import-Module CiBuildTools
  - Invoke-StartSonarQube -solutionPath $env:CI_PROJECT_DIR\src\aimp_dotnet.sln -sonarProjectKey $env:SONAR_PROJECT_KEY -sonarProjectName aimp_dotnet -version $env:VERSION -branch $env:CI_COMMIT_REF_NAME

analysis_end:
  stage: analysis_end
  script:
  - Import-Module CiBuildTools
  - Invoke-StopSonarQube

build_master:
  only:
    - master
    - tags
  except:
    - develop
  stage: build
  script:
  - Import-Module CiBuildTools
  - Invoke-BuildSolution -solutionPath $env:CI_PROJECT_DIR\src\aimp_dotnet.sln -version $env:VERSION -branch $env:CI_COMMIT_REF_NAME -configuration Debug
  artifacts:
    paths:
      - src\Release\aimp_dotnet.dll
      - src\Release\AIMP.SDK.dll

build_develop:
  only:
    - develop
  except:
    - master
  stage: build
  script:
  - Import-Module CiBuildTools
  - Invoke-BuildSolution -solutionPath $env:CI_PROJECT_DIR\src\aimp_dotnet.sln -version $env:VERSION -branch $env:CI_COMMIT_REF_NAME -configuration Release

documentation_build:
  only:
    - master
  stage: documentation
  script: .\docs\build.ps1

documentation_publish:
  only:
    - master
  stage: publish_documentation
  script: .\docs\publish.ps1